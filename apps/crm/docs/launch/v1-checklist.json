{
  "version": "v1",
  "updatedAt": "2026-01-09",
  "phases": [
    {
      "id": "phase1",
      "title": "Product Readiness",
      "items": [
        {
          "id": "p1-core-company",
          "group": "Core",
          "title": "Admin can create company",
          "routes": ["/admin/onboarding", "/admin/settings"],
          "apis": ["POST /api/auth/login", "GET/POST /api/admin/settings"],
          "db": ["Company", "User.companyId"],
          "acceptanceCriteria": [
            "First admin login auto-provisions a company (or admin can create one in Settings).",
            "companyId is persisted (DB + session cookie) and visible in Admin Settings.",
            "Re-login returns the same company."
          ]
        },
        {
          "id": "p1-core-client",
          "group": "Core",
          "title": "Admin can create client",
          "routes": ["/admin/clients"],
          "apis": ["GET/POST /api/admin/clients"],
          "db": ["Client"],
          "acceptanceCriteria": [
            "/admin/clients shows empty state when none exist.",
            "Admin can create a client (name + email required) and it appears in the table.",
            "Client record persists after refresh."
          ]
        },
        {
          "id": "p1-core-quote",
          "group": "Core",
          "title": "Admin can create quote",
          "routes": ["/admin/quotes", "/admin/quotes/new", "/admin/quotes/[quoteId]"],
          "apis": ["GET/POST /api/admin/quotes", "GET/PATCH /api/admin/quotes/[quoteId]"],
          "db": ["Quote", "QuoteItem"],
          "acceptanceCriteria": [
            "/admin/quotes/new allows manual client name/email + line items.",
            "Saving creates a quote and redirects to /admin/quotes/[quoteId].",
            "Quote totals render and are correct."
          ]
        },
        {
          "id": "p1-core-accept",
          "group": "Core",
          "title": "Client can accept quote",
          "routes": ["/client/quotes/[token]"],
          "apis": ["GET /api/client/quotes/[token]", "POST /api/client/quotes/[token]/accept"],
          "db": ["Quote.status", "Quote.acceptedAt", "AuditEvent"],
          "acceptanceCriteria": [
            "Client can open the token link /client/quotes/[token].",
            "Clicking Accept quote changes status to accepted and persists after refresh.",
            "Audit event is recorded for acceptance."
          ]
        },
        {
          "id": "p1-core-agreement-generate",
          "group": "Core",
          "title": "Agreement auto-generated",
          "routes": ["/client/agreements/[token]"],
          "apis": ["GET /api/client/agreements/[token]"],
          "db": ["Agreement", "Agreement.quoteId"],
          "acceptanceCriteria": [
            "Accepting a quote generates an Agreement linked to the quote.",
            "Client quote page shows Open agreement after acceptance."
          ]
        },
        {
          "id": "p1-core-agreement-sign",
          "group": "Core",
          "title": "Client signs agreement",
          "routes": ["/client/agreements/[token]", "/client/agreements/[token]/certificate"],
          "apis": ["POST /api/client/agreements/[token]/sign", "GET /api/client/agreements/[token]/certificate"],
          "db": ["Agreement.status", "Agreement.signedAt", "AuditEvent"],
          "acceptanceCriteria": [
            "Agreement token link loads and shows status draft.",
            "Client enters name, checks the authorisation checkbox, clicks Sign agreement.",
            "Status becomes signed, signed timestamp is shown, and certificate link appears.",
            "Signature evidence (timestamp + token + signer identity minimum) is stored."
          ]
        },
        {
          "id": "p1-core-job",
          "group": "Core",
          "title": "Job auto-created",
          "routes": ["/admin/jobs"],
          "apis": ["GET /api/admin/jobs"],
          "db": ["Job"],
          "acceptanceCriteria": [
            "After quote acceptance (or agreement signing), a Job record exists tied to the quote/client.",
            "Admin can see the job in /admin/jobs."
          ]
        },
        {
          "id": "p1-core-invoice",
          "group": "Core",
          "title": "Invoice generated",
          "routes": ["/admin/invoices"],
          "apis": ["POST /api/admin/invoices"],
          "db": ["Invoice"],
          "acceptanceCriteria": [
            "Admin can generate an invoice for a quote/job (manual action is acceptable for v1).",
            "Invoice has a token link and totals."
          ]
        },
        {
          "id": "p1-core-invoice-client",
          "group": "Core",
          "title": "Client downloads invoice",
          "routes": ["/client/invoices", "/api/client/invoices/[token]/pdf"],
          "apis": ["GET /api/client/invoices/[token]/pdf", "GET /api/client/inbox/invoices"],
          "db": ["Invoice", "AuditEvent"],
          "acceptanceCriteria": [
            "Client can access /api/client/invoices/[token]/pdf and receives a PDF.",
            "The invoice is visible in the client portal inbox."
          ]
        },

        {
          "id": "p1-ux-empty",
          "group": "UX",
          "title": "Empty states explain next step",
          "routes": ["/admin/*"],
          "apis": [],
          "db": [],
          "acceptanceCriteria": [
            "Empty tables show a clear CTA (e.g., Create your first quote).",
            "No empty screen without instruction."
          ]
        },
        {
          "id": "p1-ux-deadends",
          "group": "UX",
          "title": "No dead ends",
          "routes": ["/admin/*", "/client/*"],
          "apis": [],
          "db": [],
          "acceptanceCriteria": [
            "Every primary screen has a path forward (CTA or navigation).",
            "404s only occur on invalid tokens."
          ]
        },
        {
          "id": "p1-ux-mobile",
          "group": "UX",
          "title": "Mobile client flow tested",
          "routes": ["/client/quotes/[token]", "/client/agreements/[token]"],
          "apis": [],
          "db": [],
          "acceptanceCriteria": [
            "Quote → Accept → Agreement → Sign → Invoice PDF works on mobile viewport."
          ]
        },
        {
          "id": "p1-ux-pdf",
          "group": "UX",
          "title": "PDF looks professional",
          "routes": ["/api/client/quotes/[token]/pdf", "/api/client/agreements/[token]/pdf", "/api/client/invoices/[token]/pdf"],
          "apis": [],
          "db": [],
          "acceptanceCriteria": [
            "Quote/Agreement/Invoice PDFs have consistent typography, spacing, totals, and branding.",
            "PDFs render correctly in-browser and downloaded."
          ]
        }
      ]
    },

    {
      "id": "phase2",
      "title": "Legal & Trust",
      "items": [
        {
          "id": "p2-templates",
          "title": "Agreement templates reviewed",
          "routes": ["/client/agreements/[token]"],
          "apis": [],
          "db": ["Agreement.templateVersion"],
          "acceptanceCriteria": [
            "You have chosen the template version used in v1.",
            "Template text is present in the app and can be updated via versioning."
          ]
        },
        {
          "id": "p2-signature-evidence",
          "title": "Signature evidence stored",
          "routes": [],
          "apis": ["POST /api/client/agreements/[token]/sign"],
          "db": ["AuditEvent", "Agreement.signedAt", "Agreement.signerName"],
          "acceptanceCriteria": [
            "Store signer name, optional email, timestamp, agreement id, quote id, token used.",
            "Store at least one of: IP address / user agent (best: both)."
          ]
        },
        {
          "id": "p2-audit",
          "title": "Audit log visible (admin)",
          "routes": ["/admin/quotes/[quoteId]"],
          "apis": ["GET /api/admin/quotes/[quoteId]"],
          "db": ["AuditEvent"],
          "acceptanceCriteria": [
            "Admin can see quote + agreement audit trail for a quote.",
            "Includes action, actor role, timestamp."
          ]
        },
        {
          "id": "p2-export",
          "title": "Data export possible",
          "routes": ["/admin/xero/export-pack", "/api/admin/xero/invoices.csv"],
          "apis": ["GET /api/admin/xero/invoices.csv"],
          "db": [],
          "acceptanceCriteria": [
            "Admin can export at least: clients, quotes, invoices (CSV is fine)."
          ]
        },
        {
          "id": "p2-gdpr",
          "title": "GDPR notice page",
          "routes": ["/gdpr"],
          "apis": [],
          "db": [],
          "acceptanceCriteria": [
            "Public route /gdpr (or /legal/gdpr) exists.",
            "Explains data handling and retention at a high level."
          ]
        },
        {
          "id": "p2-terms",
          "title": "Terms of Service page",
          "routes": ["/terms"],
          "apis": [],
          "db": [],
          "acceptanceCriteria": ["Public route /terms exists."]
        },
        {
          "id": "p2-privacy",
          "title": "Privacy Policy page",
          "routes": ["/privacy"],
          "apis": [],
          "db": [],
          "acceptanceCriteria": ["Public route /privacy exists."]
        }
      ]
    },

    {
      "id": "phase3",
      "title": "Billing Readiness",
      "items": [
        {
          "id": "p3-pricing",
          "title": "Pricing page exists",
          "routes": ["/pricing"],
          "apis": [],
          "db": [],
          "acceptanceCriteria": [
            "Public route /pricing exists with 3 tiers.",
            "Includes CTA to start trial / contact."
          ]
        },
        {
          "id": "p3-plans-code",
          "title": "Plans defined in code",
          "routes": [],
          "apis": [],
          "db": [],
          "acceptanceCriteria": ["A single source of truth defines plan IDs + limits."]
        },
        {
          "id": "p3-flags",
          "title": "Feature flags exist",
          "routes": ["/admin/billing"],
          "apis": ["GET /api/admin/billing/status"],
          "db": [],
          "acceptanceCriteria": [
            "App checks plan/flags before showing premium actions.",
            "Upgrade prompt exists instead of broken actions."
          ]
        },
        {
          "id": "p3-manual-invoice",
          "title": "Manual invoice process ready",
          "routes": ["/admin/invoices"],
          "apis": [],
          "db": ["Invoice"],
          "acceptanceCriteria": [
            "You can bill a customer manually and mark them paid in-app."
          ]
        },
        {
          "id": "p3-stripe",
          "title": "Stripe account created (not live)",
          "routes": ["/admin/billing"],
          "apis": ["POST /api/admin/billing/checkout", "POST /api/admin/billing/portal"],
          "db": [],
          "acceptanceCriteria": [
            "Test keys configured.",
            "Checkout/portal endpoints respond in test mode."
          ]
        }
      ]
    },

    {
      "id": "phase4",
      "title": "Onboarding",
      "items": [
        {
          "id": "p4-wizard",
          "title": "First-login setup wizard",
          "routes": ["/admin/onboarding"],
          "apis": ["GET/POST /api/admin/settings"],
          "db": ["Company", "Brand"],
          "acceptanceCriteria": [
            "First admin login routes to /admin/onboarding until complete.",
            "Wizard captures brand + company details."
          ]
        },
        {
          "id": "p4-first-quote",
          "title": "Create your first quote CTA",
          "routes": ["/admin"],
          "apis": [],
          "db": [],
          "acceptanceCriteria": ["Visible on admin dashboard and empty states."]
        },
        {
          "id": "p4-sample-data",
          "title": "Sample client option",
          "routes": ["/admin/onboarding"],
          "apis": [],
          "db": ["Client", "Quote"],
          "acceptanceCriteria": ["One click creates a demo client + demo quote (safe to delete)."]
        },
        {
          "id": "p4-tooltips",
          "title": "Tooltips for first 3 actions",
          "routes": ["/admin/*"],
          "apis": [],
          "db": [],
          "acceptanceCriteria": [
            "On first run: tooltips guide Create client, Create quote, Send quote."
          ]
        }
      ]
    },

    {
      "id": "phase5",
      "title": "Operations",
      "items": [
        {
          "id": "p5-sentry",
          "title": "Error logging (Sentry or similar)",
          "routes": [],
          "apis": [],
          "db": [],
          "acceptanceCriteria": [
            "Client + server errors are captured.",
            "You can identify user + route for an error."
          ]
        },
        {
          "id": "p5-backups",
          "title": "Backup strategy",
          "routes": [],
          "apis": [],
          "db": [],
          "acceptanceCriteria": [
            "DB backups scheduled (or provider backups enabled).",
            "Restore procedure documented."
          ]
        },
        {
          "id": "p5-support",
          "title": "Admin support email",
          "routes": ["/support"],
          "apis": [],
          "db": [],
          "acceptanceCriteria": [
            "/support page or footer shows support email.",
            "Resend configured for outbound."
          ]
        },
        {
          "id": "p5-password-reset",
          "title": "Password reset flows tested",
          "routes": ["/admin/login", "/engineer/login", "/client/login"],
          "apis": ["POST /api/auth/magic-link/request", "POST /api/auth/password/login", "POST /api/auth/password/change"],
          "db": ["User", "Session"],
          "acceptanceCriteria": [
            "Magic link works.",
            "Password login works (where enabled).",
            "Password change/reset works."
          ]
        },
        {
          "id": "p5-invite-expiry",
          "title": "Invite links expiry tested",
          "routes": ["/admin/invites"],
          "apis": ["GET/POST /api/admin/invites"],
          "db": ["Invite"],
          "acceptanceCriteria": [
            "Invite link shows expired state after expiry.",
            "Expired tokens cannot create accounts."
          ]
        }
      ]
    },

    {
      "id": "phase6",
      "title": "Sales Launch",
      "items": [
        {
          "id": "p6-landing",
          "title": "Landing page",
          "routes": ["/"],
          "apis": [],
          "db": [],
          "acceptanceCriteria": ["/ clearly explains the niche + outcome."]
        },
        {
          "id": "p6-message",
          "title": "Clear niche message",
          "routes": ["/"],
          "apis": [],
          "db": [],
          "acceptanceCriteria": ["Headline states who it’s for and the core benefit."]
        },
        {
          "id": "p6-pricing-3tier",
          "title": "3-tier pricing",
          "routes": ["/pricing"],
          "apis": [],
          "db": [],
          "acceptanceCriteria": ["Clearly differentiated limits/features."]
        },
        {
          "id": "p6-demo-video",
          "title": "Demo video (Loom)",
          "routes": [],
          "apis": [],
          "db": [],
          "acceptanceCriteria": ["2–4 minute walk-through exists covering the core flow."]
        },
        {
          "id": "p6-pilots",
          "title": "3 pilot users onboarded",
          "routes": [],
          "apis": [],
          "db": [],
          "acceptanceCriteria": ["At least 3 real businesses actively use it this week."]
        },
        {
          "id": "p6-feedback",
          "title": "Feedback loop open",
          "routes": ["/support"],
          "apis": [],
          "db": [],
          "acceptanceCriteria": ["A feedback button/email + a weekly review cadence exists."]
        }
      ]
    }
  ],
  "qualityGates": [
    "npm run lint",
    "npm run typecheck",
    "npm run build",
    "npm run test:pw"
  ]
}
