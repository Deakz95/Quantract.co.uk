# Render Blueprint for Quantract Monorepo
# https://render.com/docs/blueprint-spec
#
# NOTE: All services build from repo root (no rootDir) because npm workspaces
# requires package-lock.json at root level for npm ci to work.

services:
  # CRM Application
  - type: web
    name: quantract-crm
    runtime: node
    region: frankfurt
    buildCommand: npm ci && npm run build:crm
    startCommand: cd apps/crm && npm run prisma:migrate:deploy && npm run start
    healthCheckPath: /api/health
    envVars:
      - key: NODE_ENV
        value: production
      # Neon API credentials (passwordless - no DATABASE_URL/DIRECT_URL stored)
      - key: NEON_API_KEY
        sync: false
      - key: NEON_PROJECT_ID
        sync: false
      - key: NEON_DATABASE
        value: neondb
      - key: NEON_ROLE
        value: neondb_owner
      # App config
      - key: APP_ORIGIN
        value: https://crm.quantract.co.uk
      - key: NEXT_PUBLIC_APP_ORIGIN
        value: https://crm.quantract.co.uk
      - key: QT_USE_PRISMA
        value: "1"
      # Third-party services
      - key: SENTRY_DSN
        sync: false
      - key: RESEND_API_KEY
        sync: false
      - key: STRIPE_SECRET_KEY
        sync: false
      - key: STRIPE_WEBHOOK_SECRET
        sync: false

  # Marketing Site
  - type: web
    name: quantract-marketing
    runtime: node
    region: frankfurt
    buildCommand: npm ci && npm run build:marketing
    startCommand: cd apps/marketing && npm run start
    healthCheckPath: /api/health
    envVars:
      - key: NODE_ENV
        value: production
      - key: APP_ORIGIN
        value: https://www.quantract.co.uk

  # Certificates Application
  - type: web
    name: quantract-certificates
    runtime: node
    region: frankfurt
    buildCommand: npm ci && npm run build:certificates
    startCommand: cd apps/certificates && npm run start
    healthCheckPath: /api/health
    envVars:
      - key: NODE_ENV
        value: production
      - key: APP_ORIGIN
        value: https://certificates.quantract.co.uk

  # Tools Application
  - type: web
    name: quantract-tools
    runtime: node
    region: frankfurt
    buildCommand: npm ci && npm run build:tools
    startCommand: cd apps/tools && npm run start
    healthCheckPath: /api/health
    envVars:
      - key: NODE_ENV
        value: production
      - key: APP_ORIGIN
        value: https://apps.quantract.co.uk
